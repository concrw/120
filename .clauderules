# 120 프로젝트 개발 규칙

## 언어 규칙
- **코드**: 영어로 작성 (변수명, 함수명, 주석 모두 영어)
- **사용자와 대화**: 한국어로 설명 및 응답
- **커밋 메시지**: 영어 사용

## 필수 참조 문서
- `/프로젝트_기획서.md` - 모든 기능, 스펙의 절대 기준
- 이 문서와 충돌하는 요청은 반드시 사용자에게 확인

## 절대 금지 사항
1. ❌ FastAPI 사용 금지 → Next.js API Routes만 사용
2. ❌ 15초 이외 영상 길이 지원 금지
3. ❌ MVP에 Phase 2 기능 포함 금지 (Phase 1.5는 완료됨)
4. ❌ 대화형 UI (ChatGPT 스타일) 금지
5. ❌ 요청하지 않은 기능 추가 금지 (Scope creep)
6. ❌ 주석, README, 문서 자동 생성 금지
7. ❌ any 사용 최소화 (불가피한 경우 예외, 타입 정의 우선)
8. ❌ @ts-ignore 사용 금지 (절대 금지)
9. ❌ 기존 함수명/API 변경 금지 (Breaking change)
10. ❌ 새 npm 패키지 무단 설치 금지
11. ❌ 파일 전체 재작성 금지 (Edit 도구 사용)
12. ❌ Over-engineering 금지 (추상화, 유틸리티 남발)
13. ❌ 미리 최적화 금지 (useMemo, useCallback 남발)

## 필수 준수 사항
1. ✅ 수정 전 반드시 파일 먼저 읽기
2. ✅ 요청한 것만 정확히 구현
3. ✅ 가장 간단한 방법 선택
4. ✅ 기존 코드 스타일/패턴 따르기
5. ✅ TypeScript strict 모드 준수
6. ✅ Edit 도구로 최소 변경만
7. ✅ 품질 threshold 90% 유지
8. ✅ 재시도 로직 3회 고정
9. ✅ 불확실하면 먼저 질문하기

## 기술 스택 (절대 변경 금지)

### 프론트엔드
- Next.js 14 (App Router)
- TypeScript (strict mode)
- Tailwind CSS
- Shadcn/ui

### 백엔드
- Next.js API Routes (FastAPI 절대 금지)
- Supabase (PostgreSQL + Storage)
- Inngest (Background Jobs)

### AI 서비스
- Replicate API (SDXL, Stable Video Diffusion, rembg)
- OpenAI GPT-4 & GPT-4 Vision
- FAL AI (LoRA Training, Image/Video Generation) - Phase 1.5
- Resend (Email Notifications) - Phase 1.5
- Stripe (Payment Processing)

## 핵심 기준점

### 영상 스펙
- 길이: 15초 (고정, 절대 변경 불가)
- 해상도: 1080p
- 프레임레이트: 30fps

### 품질 기준
- 제품 디테일: 90% threshold
- 자동 재시도: 최대 3회
- 색상 정확도: Delta E < 5

### 비용 구조
- 영상당 원가: ~$4.35
- 판매가 목표: $15-30
- 마진: 3-7배

## 작업 원칙

### 파일 수정 시
1. Read 도구로 파일 먼저 읽기
2. 기존 패턴 100% 유지
3. Edit 도구로 최소한만 수정
4. Write 도구로 전체 재작성 금지

### 새 기능 추가 시
1. 기획서에 명시된 것만
2. MVP vs Phase 1.5 구분 엄수
3. 요청 외 개선사항 추가 금지
4. 가장 간단한 구현 선택

### 에러 처리
1. 시스템 경계에만 try-catch
2. 내부 함수에 과도한 에러 처리 금지
3. 발생 불가능한 에러 처리 금지
4. any로 에러 회피 금지

### 타입 안전성
1. any 사용 최소화 (외부 라이브러리 타입 이슈 시 예외)
2. @ts-ignore 절대 사용 금지
3. as unknown as 최소화
4. 정확한 타입 정의 우선 사용

## 코드 스타일

### API Routes 구조
```typescript
export async function POST(req: Request) {
  try {
    const session = await getSession();
    if (!session) return unauthorized();

    const body = await req.json();
    const validated = schema.parse(body);

    const result = await processLogic(validated);

    return json({ success: true, data: result });
  } catch (error) {
    return handleError(error);
  }
}
```

### 컴포넌트 구조
```typescript
export function Component() {
  const [state, setState] = useState();
  const { data } = useQuery('key', fetcher);

  const handleAction = async () => {
    try {
      await action();
    } catch (error) {
      toast.error(error.message);
    }
  };

  return <div>...</div>;
}
```

## 의심스러울 때

1. 기획서 확인
2. 기존 코드 패턴 확인
3. 사용자에게 질문
4. 추측으로 수정 금지

## 기억하세요

- **적게 하는 것이 더 낫습니다**
- **요청한 것만 하세요**
- **추측하지 마세요**
- **간단하게 유지하세요**